const brain = require("brain.js");

const data = [
    100,
    99.42199906585707,
    95.20427236470162,
    94.77935582941888,
    91.335219348336,
    100.34732075523236,
    105.5818946263039,
    107.48084956562593,
    108.16800058605291,
    106.73395512373783,
    106.12219610920526,
    105.21068916388246,
    100.7942621305983,
    101.66636382669822,
    102.91374604504972,
    104.8130537031392,
    100.92208187193218,
    103.14523240400165,
    102.2707649554804,
    102.52991520102115,
    97.35303434255093,
    100.27205906687782,
    96.34318131765991,
    97.10221594818735,
    97.542090086118,
    99.5454191082194,
    98.64392104827378,
    99.8146401112643,
    98.98464280476361,
    100.32151244742107,
    101.53333399553487,
    101.39562820962558,
    102.38052071294582,
    99.8708787847215,
    100.82022173894887,
    104.86524899747997,
    104.8259589079343,
    104.43747481068436,
    103.64332838256497,
    104.68293825210311,
    104.17757234329986,
    102.88541457328334,
    103.37459148497284,
    104.33715812952784,
    98.27607840416105,
    99.72601452417908,
    95.72241540094562,
    94.09353024674786,
    94.77285221364312,
    95.57008208883656,
    97.80702466836323,
    102.13702315628557,
    103.56137014094067,
    102.285197988865,
    102.71683313832368,
    99.98168567754877,
    97.88426689933796,
    100.44472728689554,
    92.78273388049143,
    89.86719510790668,
    89.48694654696142,
    95.19051017303148,
    96.08530780787555,
    96.15706681295985,
    100.7559874659773,
    100.7676645810571,
    98.07719844718358,
    97.23815950284731,
    94.10587632021814,
    97.14581333618024,
    96.57016855461956,
    94.74852497395696,
    97.17000645998691,
    96.08050393485742,
    95.00581042973641,
    97.0003000496131,
    98.11570391055322,
    90.9850863709718,
    91.07457989854981,
    84.51501052977846,
    84.66576866486547,
    87.68738781778714,
    82.51680679137482,
    82.97016933964703,
    82.72915214476062,
    82.45279611278099,
    84.71094078796447,
    92.62182223229144,
    94.42100292833439,
    94.49964496777734,
    93.60993748321187,
    82.34915531920544,
    85.18309383984088,
    87.02025618002438,
    89.24059637696317,
    94.02947313225027,
    92.43995631449367,
    86.92380877695891,
    86.45410903348328,
    85.63280984042169,
    85.16756287101065,
    79.78092035614745,
    78.72336531747882,
    78.88781679200156,
    77.47036557451486,
    81.04531850701585,
    86.33745684236204,
    87.24826202003823,
    91.28560929282665,
    95.63972363241842,
    94.27320135190594,
    92.92218196111465,
    82.55978135135562,
    81.75255764203212,
    90.49314497207772,
    89.48595329649748,
    86.13280938934588,
    87.71589553341113,
    90.25209974671662,
    93.60026996891104,
    96.13132886944202,
    99.78188566195247,
    99.54060170014075,
    99.89483871686723,
    101.25937013332754,
    107.82374373255541,
    107.73223325637638,
    112.63981774772856,
    112.85977833626485,
    111.8748345972391,
    107.24671324771083,
    107.24671324771083,
    110.08157859788916,
    110.25315213061657,
    106.89599960078147,
    106.34136528540179,
    104.38115578705339,
    96.97440046311657,
    95.86052812922068,
    99.1346377167328,
    100.66637036039057,
    100.94980227884739,
    105.78326454343531,
    104.24152443960527,
    102.08433163303663,
    99.41115322720228,
    103.09762954150122,
    98.38282044081505,
    99.09707032993113,
    97.56754609250733,
    94.50849761765976,
    99.53489142201119,
    99.7768725194715,
    100.56666306711905,
    98.33379418752696,
    98.67888270322516,
    87.01415507621704,
    90.01870613165852,
    80.94475271094494,
    80.75285356565524,
    83.14939909581955,
    83.94251795679634,
    85.34265951035044,
    72.87567539379141,
    71.40425022981987,
    70.9862741309136,
    69.84988767204092,
    70.53171954736453,
    73.61703383071823,
    79.78803334311596,
    87.59013404821792,
    94.88931188556941,
    91.3388105966729,
    96.28772578771931,
    94.70553311045632,
    96.69552521019847,
    99.48895149404864,
    97.45352967178975,
    94.842821938156,
    91.95550993044348,
    86.17832591239424,
    85.30680209293517,
    85.93881851610291,
    77.80947081863371,
    77.72598426196136,
    74.55028861095198,
    74.84738874724366,
    78.0628656776867,
    78.97521472870423,
    77.42023961895991,
    74.73175957718065,
    74.47691981732667,
    73.2557626126131,
    74.45409191923355,
    73.17915069434892,
    72.01983304146727,
    76.48904797724212,
    76.44545205363012,
    76.03567051766797,
    75.753062561832,
    76.11574277182149,
    75.61243073848088,
    78.79373811121935,
    80.00292281397967,
    84.09111871378839,
    88.30330542250084,
    91.00948449674179,
    85.71989525316155,
    81.45758001957893,
    76.53829454770383,
    79.2751756104454,
    80.13365688720562,
    81.59407098282927,
    81.46772525507636,
    80.7096508885589,
    87.1532830039573,
    86.99698928863974,
    86.99698928863974,
    86.10562669346926,
    85.2331059092536,
    90.19429967066593,
    88.81572843312958,
    89.65271352343066,
    90.7673473945217,
    90.18859703919,
    89.98078921191076,
    90.66957743830675,
    88.07628734572832,
    85.49911185310877,
    89.39744848319643,
    89.65757684929689,
    94.35851107449692,
    84.70657177374684,
    84.17172364889288,
    81.35626708481941,
    80.72775938321094,
    81.4269761967663,
    80.68673095861388,
    76.385176642565,
    78.42639498595919,
    79.24052678307439,
    81.3463642303214,
    84.3320687346199,
    75.3922734623987,
    76.14396144895456,
    77.0981464295179,
    76.33353671286153,
    77.03442895312988,
    74.76871045450841,
    72.1253722061167,
    71.37698172346506,
    67.7228700311375,
    66.8032578289688,
    66.30808543266242,
    68.09708232118803,
    65.59854933901099,
    64.48567312912098,
    65.21957684455104,
    67.6806929518926,
    67.06541392505721,
    67.10897546701202,
    63.739487159044884,
    61.74657261618127,
    60.95348740443124,
    61.22657650570558,
    62.040728322798216,
    60.35956309034056,
    61.98213199061853,
    63.38202722935557,
    63.13588613453799,
    62.55738986347903,
    63.895993070258186,
    64.62335551326464,
    67.74804501606187,
    63.95791003959801,
    48.25380449174647,
    47.89636890291872,
    44.98093775230627,
    43.583600928639946,
    42.00763530902579,
    39.59833879215378,
    40.813859895977224,
    41.297818708973,
    42.19659936167944,
    39.24675516818137,
    43.184856028842674,
    44.469833669300456,
    43.45504433068163,
    46.99942224815622,
    45.90700324455043,
    45.187228280046455,
    45.76526290209377,
    44.84582957605744,
    45.71241565482184,
    47.08207604897381,
    47.2407351089535,
    47.24874201320926,
    46.9345359150333,
    48.87888953176656,
    49.157584954535395,
    48.24647280025175,
    45.81924513068922,
    45.76204257746738,
    43.98876342759053,
    43.6114386721242,
    42.76543598207329,
    44.60782709000284,
    45.65418352791649,
    46.09681411613729,
    44.549054542254815,
    43.23672047893747,
    41.432261141876126,
    42.37604841162273,
    44.28476000726666,
    42.76385894904776,
    43.23305489362979,
    42.80693250704971,
    42.09437839166615,
    43.30854036923071,
    43.663528405044076,
    44.60957152048669,
    45.28752853447585,
    45.665825312210124,
    46.92632708175889,
    52.35133599294489,
    53.75573827129444,
    53.64620034307988,
    54.26677831062667,
    54.6404351881732,
    54.94787497695576,
    54.235368408468666,
    54.46867225880622,
    55.47343417425993,
    55.92888108866271,
    55.67066834125429,
    55.73169401222305,
    55.62553840458072,
    56.4915243441587,
    55.55773447579379,
    58.031016938399404,
    61.77999246066477,
    60.497939443784134,
    58.98804146103876,
    58.83896161220998,
    58.8931224329323,
    55.72953703170822,
    50.417444991239016,
    50.09412464978462,
    51.08461394979573,
    53.346300419180324,
    53.346300419180324,
    52.49470611374302,
    52.65149850096416,
    51.270475589463466,
    51.30750544182896,
    51.397756111031825,
    50.92540577161445,
    51.125053932049646,
    50.86517611631372,
    50.279846126482724,
    50.258025644275286,
    53.318835202341326,
    53.55248478692653,
    53.43823948604775,
    53.46642421151507,
    50.455722904754595,
    49.851279277155406,
    49.57636413408285,
    52.945167672832575,
    53.68175727367722,
    54.19155553838452,
    52.360439767206955,
    52.951112352007776,
    55.18663116819353,
    52.929195500868694,
    53.27565259727425,
    53.47189567004838,
    52.649211068474045,
    53.08035877109579,
    54.46106174491042,
    55.386444688208336,
    56.3076329574509,
    55.92070889734545,
    55.607134828762206,
    55.10709711805659,
    55.710083769201596,
    55.57085496937853,
    57.45131563928748,
    56.801037520706444,
    58.8973851269188,
    58.489320102944774,
    58.55459836198824,
    58.10417837458833,
    58.05966546980699,
    58.547375527208956,
    58.65893683728367,
    57.811264339635066,
    54.53809405567715,
    55.023041105705886,
    59.47843693516672,
    59.39590441398009,
    59.12079601002465,
    57.53394838407549,
    56.397422381706505,
    56.54745986365606,
    56.80761906118849,
    56.96382699627883,
    56.81082607168015,
    57.59214396528695,
    57.24656105080702,
    57.471830351548014,
    58.71194577631866,
    57.2637177805028,
    59.2930475073365,
    58.52384388391723,
    58.33822721488242,
    59.5766393582809,
    59.8921935921701,
    58.91946655006989,
    59.53079554110818,
    62.176033499500036,
    62.56093930051397,
    62.42946272054791,
    64.28865105451338,
    64.28865105451338,
    64.83193542962195,
    65.4888771439183,
    64.3782328967631,
    64.47133229357692,
    64.75969277229113,
    65.5416487590986,
    65.49169323412978,
    66.8862190313769,
    67.64089913005459,
    67.53678472316979,
    67.69285825548089,
    71.18797912683212,
    70.83816104758478,
    70.35088713894638,
    70.47327083711177,
    75.47384946086721,
    75.92426423450497,
    75.2985148040008,
    76.75791312427215,
    77.221507077568,
    76.05091210475402,
    75.82434533582227,
    75.05728063844421,
    75.73927511168601,
    76.72228308725654,
    78.47122115333165,
    82.37573579809694,
    76.09545285371443,
    75.97860264458913,
    75.67998544349112,
    74.88515606009689,
    72.90419667379125,
    72.92663563860313,
    72.2534666942468,
    73.71330616869676,
    73.15387737565625,
    73.21096194637467,
    74.63714951675858,
    76.23110892982336,
    75.6312688190896,
    72.4918012460497,
    71.78915850351221,
    72.04906132754743,
    71.82414230155094,
    75.31038720449678,
    73.80071980595184,
    73.9292629112039,
    72.43784008945082,
    73.53427561048187,
    72.65321977367425,
    71.91412292958805,
    72.47507552654271,
    72.13187879006604,
    72.32935384749621,
    71.06846178359375,
    76.04325410844531,
    71.03861484957964,
    69.71266785295288,
    70.30087015899144,
    70.53250399806555,
    71.71354568037741,
    72.29658263712844,
    71.6687901515681,
    71.41214273831272,
    71.60462829825427,
    70.88025947991206,
    71.39671974991363,
    73.71410822933844,
    73.71546779163631,
    73.54518585014907,
    74.15980600216845,
    72.88932183370068,
    68.78288116701331,
    68.71837550728375,
    66.75972854040218,
    65.93770901571826,
    65.99411424156575,
    64.42282580724276,
    63.44513522588624,
    63.18757428639982,
    62.871817884164514,
    62.09590434221838,
    61.55263308813073,
    60.3574363291379,
    61.70557189278037,
    61.25802468050273,
    64.33579012262905,
    62.008750905427576,
    63.103828184110625,
    64.33579012262905,
    64.17551162207441,
    64.88073702451479,
    67.06396942371148,
    67.86620096997237,
    66.35806317063965,
    66.49789519324227,
    65.42828825238156,
    65.12294493152524,
    64.6295892881046,
    65.49296166409073,
    65.09596171278379,
    64.55322992073418,
    65.6255026835086,
    66.31942793847017,
    65.08475773748802,
    65.59618911999225,
    73.46103832570559,
    72.95309683339302,
    75.01854241681708,
    75.50132376943894,
    73.62968197347062,
    78.53832743836867,
    78.29166552612674,
    83.20948371244123,
    83.80872896551435,
    81.64029074967274,
    81.64029074967274,
    82.63468358710779,
    80.99807857480857,
    81.2675108528121,
    81.84661425556372,
    81.60212758614223,
    85.72146575755806,
    84.00434789745607,
    83.31041569821137,
    85.91658094424511,
    84.5999189967955,
    84.1412032070868,
    84.05317404941592,
    85.87465036481458,
    86.97107300126814,
    87.97907445736254,
    88.65910595075279,
    90.65948035064443,
    88.90182254109273,
    87.5054588362588,
    87.38190718241304,
    87.97732289278562,
    86.6701299965202,
    87.99519012351264,
    88.34986642388957,
    85.33385906290066,
    85.8033283040316,
    82.39486505554041,
    82.65306623433563,
    81.51684149583049,
    76.25769043158337,
    77.99146572652432,
    78.35291196043711,
    80.43527384536749,
    80.16084285344584,
    80.08843016794138,
    80.46415366749467,
    75.9594037517469,
    75.44749486176623,
    68.82929355810252,
    70.61149223840115,
    74.69508177189034,
    74.99962065235394,
    76.14574666041284,
    75.1087423284617,
    77.22140336388885,
    77.41051700478002,
    79.69684403390934,
    80.44186776416662,
    79.87876095550504,
    82.89090918079269,
    82.73984530048405,
    82.01747891930295,
    81.53716360353773,
    83.536156773938,
    83.63134692490944,
    87.33184900123285,
    86.46931222097376,
    105.13072886174403,
    105.06805948454361,
    105.77451428207551,
    104.15189469577331,
    101.74979994134615,
    102.65843336963451,
    106.30588586316385,
    106.43779947987012,
    106.29345257432018,
    106.96105701248857,
    106.4441758328491,
    105.7772097861403,
    104.48761385501267,
    103.24968823457223,
    94.44319776739688,
    95.91841172814972,
    97.74821947882792,
    98.50899058884771,
    98.17892695909525,
    101.46003354119449,
    100.61178714024261,
    99.8510097926263,
    97.6806610563153,
    94.47749652167639,
    91.03647323446528,
    94.26744490579158,
    95.06920059981516,
    95.45342638949727,
    94.48645969669484,
    93.14832184225395,
    93.91336840113267,
    94.14756632732004,
    93.66455187844109,
    88.42247017151001,
    89.26416948356379,
    88.75226628355463,
    91.25212178387476,
    94.33859060891758,
    95.54386664456052,
    96.0846460409593,
    97.95188163722857,
    93.77233139462425,
    89.0603963751379,
    85.65013082910906,
    85.01904090391491,
    86.33084500618128,
    82.7643237347107,
    87.80832973056002,
    91.73330649462382,
    91.66002537424147,
    90.19910241215437,
    90.19910241215437,
    89.11811211183247,
    86.1829665095639,
    87.99161842825387,
    91.25438335826328,
    91.72884289045528,
    93.2543406391758,
    93.2543406391758,
    92.8788728552927,
    93.39095485587323,
    92.68708519144184,
    93.28649112018161,
    90.9456128059005,
    97.652810245401,
    97.04858057705725,
    99.90885415145861,
    99.28138110968443,
    99.07042034563968,
    98.15911055570069,
    96.68856208295611,
    94.09868988430551,
    92.95170439083519,
    90.94724903187848,
    91.94232026335995,
    90.51136999713793,
    92.5783363792841,
    93.94113867462941,
    99.62282248933944,
    99.59048721567042,
    100.86031127852961,
    101.26674175423926,
    103.35673093075586,
    105.87728336081108,
    104.2181535022126,
    102.52641479132109,
    102.75663016078629,
    101.30709476742857,
    100.42401792546148,
    99.03953613330447,
    97.20100867493817,
    98.3141305812074,
    96.72380749474293,
    97.4275377028696,
    97.90951138761878,
    98.48251245752375,
    98.47794398730723,
    98.8901182538349,
    101.88261486850527,
    102.40598446543254,
    102.43167717065243,
    103.62731481363495,
    103.58661280467437,
    105.26285634942764,
    115.86324176592261,
    116.14112737649069,
    109.54985968409073,
    107.1132161812998,
    102.94391194211262,
    107.43490005309847,
    103.07080074446864,
    100.93382745987395,
    99.21447206729967,
    102.0460250991871,
    102.0482184109934,
    100.48467418491029,
    103.01009128003834,
    102.65543283290336,
    104.72374970183297,
    102.86834780470495,
    107.48300265949547,
    107.39413701033507,
    117.21800657842495,
    118.81818327095917,
    118.71853941293872,
    121.15981393443978,
    117.38762178926444,
    122.5565417610551,
    123.5092400176312,
    126.0103914548253,
    127.26995938302112,
    126.26682410994171,
    123.54201072320437,
    127.31785899233992,
    126.08008705462623,
    126.42134180133706,
    126.68146801903528,
    127.66050512550558,
    132.0033556929744,
    119.95918345252754,
    119.35332899064609,
    120.31328158301595,
    116.45017139333336,
    120.27086379550583,
    121.3839430514688,
    122.2143717739461,
    125.50312242050124,
    127.13180335126376,
    127.12115044332414,
    126.67573646139239,
    126.1265216066965,
    129.31464686078482,
    130.95831674604128,
    131.21243676119605,
    137.3952217394723,
    138.60983520629028,
    140.282005897129,
    141.61295471968242,
    142.88092181284372,
    144.08646452135574,
    142.6799588015824,
    147.21560848955966,
    168.1805855984015,
    162.64233371750373,
    163.938406819091,
    160.62785740836622,
    161.54748254620034,
    164.20922813948374,
    168.40838740550018,
    171.0397684587111,
    169.6575438294529,
    170.16800142850212,
    170.03232243684437,
    170.9663156335098,
    173.00247820060338,
    165.00395788523073,
    165.0541171623116,
    167.83870362872335,
    167.84532918942242,
    172.48962582653112,
    168.65303295239784,
    163.11381384489678,
    166.5898173652776,
    165.03970768726992,
    171.3106059301191,
    184.0658734874668,
    186.96386065657995,
    187.41683185138695,
    185.45470158274225,
    185.9794203741951,
    186.21421816951235,
    182.97463345538816,
    175.65767708254467,
    179.20536141839784,
    182.80034821206246,
    181.2547512109048,
    184.55574833560672,
    182.75520444940565,
    177.37144562476738,
    178.32379433299172,
    178.72015098637647,
];

const answers = [];
const lookBack = 20;
for (let i = lookBack; i < data.length - 1; i++) {
    let arr = [];
    for (let j = i - lookBack; j < i; j++) {
        arr.push(Math.sqrt(data[j]));
        // if (data[j + 1] < data[j]) {
        //     arr.push(0);
        // } else {
        //     arr.push(1);
        // }
    }
    const answer = data[i + 1] > data[i] ? 1 : 0;
    answers.push({
        input: arr,
        output: [answer],
        answerDiff: data[i + 1] - data[i]
    });
}

const table = {};
const trainAnswers = answers.slice(0, Math.floor(answers.length / 1.5));
const testAnswers = answers.slice(Math.floor(answers.length / 1.5), answers.length);
trainAnswers.forEach((answer) => {
    const code = answer.input.join("-");
    if (!table[code]) {
        table[code] = {
            up: 0,
            down: 0
        }
    }
    if (answer.output[0] === 1) {
        table[code].up += 1;
    } else {
        table[code].down += 1;
    }
});

let right = 0;
let wrong = 0;
let tie = 0;
let noData = 0;
// testAnswers.forEach((answer) => {
//     const code = answer.input.join("-");
//     if (table[code]) {
//         let prediction;
//         if (table[code].up > table[code].down) {
//             prediction = 1;
//         } else if (table[code].up < table[code].down) {
//             prediction = 0;
//         } else {
//             tie += 1;
//         }
//         if (prediction !== undefined) {
//             if (prediction === answer.output[0]) {
//                 right += 1;
//             } else {
//                 wrong += 1;
//             }
//         }
//     } else {
//         noData += 1;
//     }
// });

const net = new brain.NeuralNetwork();
net.train(trainAnswers);

testAnswers.forEach((answer) => {
    const prediction = net.run(answer.input);
    if (Math.round(prediction) === answer.output[0]) {
        right += 1;
    } else {
        wrong += 1;
    }
});


console.log("right: " + right);
console.log("wrong: " + wrong);
console.log("tie: " + tie);
console.log("no data: " + noData);